{"version":3,"file":"authDialog.e20fae3e.js","sources":["../../src/views/system/role/components/authDialog.vue"],"sourcesContent":["<template>\n  <el-dialog\n    v-model=\"formData.visible\"\n    :title=\"formData.title\"\n    width=\"600px\"\n    destroy-on-close\n    :close-on-click-modal=\"false\"\n    top=\"0\"\n  >\n    <el-tree\n      v-if=\"list.length\"\n      node-key=\"id\"\n      show-checkbox\n      :data=\"list\"\n      highlight-current\n      :default-expanded-keys=\"roleMenu\"\n      :default-checked-keys=\"roleMenu\"\n      :props=\"{\n        children: 'children',\n        label: 'title',\n      }\"\n      @check=\"eventCheck\"\n    />\n    <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button @click=\"formData.visible = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"handleSubmit\">提交</el-button>\n      </span>\n    </template>\n  </el-dialog>\n</template>\n\n<script lang='ts'>\nimport { defineComponent, onMounted, reactive, ref } from 'vue';\nimport { getMenu, getRoleMenu, setRoleMenu } from '@/api/menu';\nimport { useMenuStore } from '@/store/modules/menu';\nimport { toast } from '@/utils/message';\n\nexport default defineComponent({\n  name: 'AuthDialog',\n  props: {\n    dialogData: {\n      type: Object,\n      default: () => {\n        return {\n          visible: false,\n          title: '',\n          data: {}\n        };\n      }\n    }\n  },\n  setup(props) {\n    const menuStore = useMenuStore();\n    let list = reactive<Array<Menu.MenuRow>>([]);\n    let roleMenu = reactive<Array<number>>([]);\n    let formData = reactive(props.dialogData);\n\n    // 请求角色菜单\n    const getList = async () => {\n      const { result } = await getRoleMenu(props.dialogData.data.id);\n      roleMenu.push(...result);\n    };\n\n    // 请求菜单列表\n    const getMenuList = async () => {\n      const { result } = await getMenu({ attrs: 'id,title,pid,sort' }, true);\n      result.sort((a: Menu.MenuRow, b: Menu.MenuRow) => a.sort - b.sort);\n      let topMenus: Menu.MenuRow[] = result.filter((item: Menu.MenuRow) => item.pid === 0);\n      for (const item of topMenus) menuStore.deepMergeMenu(item, result);\n      list.push(...topMenus);\n    };\n\n    // 监听选中的节点\n    const eventCheck = (node: any, obj: any) => {\n      roleMenu.length = 0;\n      roleMenu.push(...obj.checkedKeys);\n    };\n\n    // 修改角色菜单\n    const handleSubmit = async () => {\n      try {\n        const { code, message, result } = await setRoleMenu(props.dialogData.data.id, roleMenu);\n        toast(message);\n        formData.visible = false;\n      } catch (error: any) {\n        toast(error.message, 'error');\n      }\n    };\n\n    onMounted(async () => {\n      await getList();\n      await getMenuList();\n    });\n\n    return {\n      roleMenu,\n      list,\n      formData,\n      eventCheck,\n      handleSubmit\n    };\n  }\n});\n</script>\n\n<style lang='less' scoped>\n</style>\n"],"names":["_withCtx","_createElementVNode","_createVNode","_openBlock","_createBlock","_createCommentVNode"],"mappings":"4SAsCA,KAAA,GAAA,EAAA,CAA+B,KAAA,aACvB,MAAA,CACC,WAAA,CACO,KAAA,OACJ,QAAA,IAEJ,EAAO,QAAA,GACI,MAAA,GACF,KAAA,CAAA,CACA,EAEX,CACF,EACF,MAAA,EAAA,CAEE,KAAA,GAAA,IACA,GAAA,GAAA,EAAA,CAAA,CAAA,EACA,EAAA,EAAA,CAAA,CAAA,EACA,EAAA,EAAA,EAAA,UAAA,EAGA,KAAA,GAAA,SAAA,CACE,KAAA,CAAA,UAAA,KAAA,GAAA,EAAA,WAAA,KAAA,EAAA,EACA,EAAA,KAAA,GAAA,CAAA,CAAuB,EAIzB,EAAA,SAAA,CACE,KAAA,CAAA,UAAA,KAAA,GAAA,CAAA,MAAA,mBAAA,EAAA,EAAA,EACA,EAAA,KAAA,CAAA,EAAA,IAAA,EAAA,KAAA,EAAA,IAAA,EACA,GAAA,GAAA,EAAA,OAAA,AAAA,GAAA,EAAA,MAAA,CAAA,EACA,SAAA,KAAA,GAA6B,EAAA,cAAA,EAAA,CAAA,EAC7B,EAAA,KAAA,GAAA,CAAA,CAAqB,EAIvB,EAAA,CAAA,EAAA,IAAA,CACE,EAAA,OAAA,EACA,EAAA,KAAA,GAAA,EAAA,WAAA,CAAgC,EAIlC,EAAA,SAAA,CACE,GAAA,CACE,KAAA,CAAA,OAAA,UAAA,UAAA,KAAA,GAAA,EAAA,WAAA,KAAA,GAAA,CAAA,EACA,EAAA,CAAA,EACA,EAAA,QAAA,EAAmB,OAAA,EAAA,CAEnB,EAAA,EAAA,QAAA,OAAA,CAA4B,CAC9B,EAGF,SAAA,SAAA,CACE,KAAA,GAAA,EACA,KAAA,GAAA,CAAkB,CAAA,EAGpB,CAAO,WACL,OACA,WACA,aACA,cACA,CACF,CAEJ,CAAA,EA/EY,EAAA,CAAA,MAAA,mHAKE,WAAA,EAAA,SAAA,QA3BQ,sBAAA,EAAA,IAAA,GAAA,GAAA,AAAA,GAAA,EAAA,SAAA,QAAA,GAAO,MAAA,EAAA,SAAA,MACR,MAAA,QACX,mBAAA,GACN,uBAAA,GACuB,IAAA,GACnB,EAAA,CAgBO,OAAAA,EAAA,IAAA,CAIFC,EAAA,OAAA,EAAA,CAAAC,EAAA,EAAA,CAFsD,QAAA,EAAA,IAAA,GAAA,GAAA,AAAA,GAAA,EAAA,SAAA,QAAA,GAAxB,EAAA,gBAAY,eACe,KAAA,UAA9C,QAAA,EAAA,YAAkB,EAAA,gBAAgB,2CAJpD,EAAA,KAAA,OAAAC,GAAA,EAAAC,EAAA,EAAA,CAAA,IAAA,kBAXS,gBAAA,GACT,KAAA,EAAA,KACO,oBAAA,GACP,wBAAA,EAAA,SACwB,uBAAA,EAAA,SACD,MAAA,CACf,SAAA,8CAIA,EAAA,KAAA,EAAA,CAAA,OAAA,wBAAA,uBAAA,SAAA,CAAA,GAAAC,EAAA,GAAA,EAAA"}