{"version":3,"file":"tag.066716db.js","sources":["../../src/api/cms/tag.ts","../../src/views/cms/tag/tag.vue"],"sourcesContent":["import { request, Response } from \"@/utils/http\";\n\n// 获取标签列表\nexport const requestList = (data: TableListQuery) => {\n  return request<Response>({\n    method: 'get',\n    url: '/api/v1/blog/tag/list',\n    data\n  });\n};\n","<template>\n  <div class=\"page-main\">\n    <div class=\"operate-box\">\n      <div class=\"operate-btns\">\n        <el-button type=\"primary\" @click=\"group = ''; openDialog(dialogData, '新增标签')\">新增</el-button>\n      </div>\n      <el-button type=\"primary\" icon=\"Refresh\" @click=\"() => { getList() }\" />\n    </div>\n\n    <el-tree\n      v-loading=\"list.load\"\n      :data=\"list.data\"\n      node-key=\"id\"\n      :props=\"{\n        children: 'children',\n        label: 'name',\n      }\"\n      default-expand-all\n      :expand-on-click-node=\"false\"\n    >\n      <template #default=\"{ node, data }\">\n        <span class=\"custom-tree-node\">\n          <template v-if=\"data.id\">{{ data.id }}_</template>\n          {{ node.label }}\n          <template v-if=\"data.group\">\n            <el-button\n              type=\"primary\"\n              :icon=\"Edit\"\n              size=\"small\"\n              @click=\"openDialog(dialogData, '编辑标签', data)\"\n            />\n            <el-button\n              type=\"danger\"\n              :icon=\"Delete\"\n              size=\"small\"\n              @click=\"handleDelete([data.id], MODULE)\"\n            />\n          </template>\n          <template v-else>\n            <el-button\n              type=\"primary\"\n              :icon=\"Plus\"\n              size=\"small\"\n              @click=\"() => { group = node.label; openDialog(dialogData, '新增标签'); }\"\n            />\n          </template>\n        </span>\n      </template>\n    </el-tree>\n\n    <tag-dialog\n      v-if=\"dialogData.visible\"\n      :dialog-data=\"dialogData\"\n      :module=\"MODULE\"\n      :group=\"group\"\n    />\n  </div>\n</template>\n\n<script lang='ts'>\nimport { requestList } from '@/api/cms/tag';\nimport { defineComponent, reactive, ref } from 'vue';\nimport { Edit, Delete, Plus } from '@element-plus/icons-vue';\nimport TagDialog from './components/tagDialog.vue';\nimport { openDialog, handleDelete } from '@/api/base';\nimport { emitter } from '@/utils/mitt';\n\ninterface ListData {\n  name: string;\n  children: Array<Tag.TagRow>\n}\nconst MODULE = 'blog/tag';\nexport default defineComponent({\n  name: \"Tag\",\n  components: { TagDialog },\n  setup() {\n    let group = ref<string>('');\n    let dialogData = reactive<DialogData<Tag.TagRow | {}>>({\n      visible: false,\n      title: \"\",\n      data: {}\n    });\n    let list = reactive<TableList<ListData>>({\n      data: [],\n      load: false,\n      query: {\n        limit: 20,\n        page: 1,\n        total: 0,\n        attrs: \"all\"\n      }\n    });\n    const mergeTags = (tags: Array<Tag.TagRow>) => {\n      let arr: Array<ListData> = [];\n      for (const tag of tags) {\n        let item = arr.find(item => item.name === tag.group);\n        if (item) {\n          item.children ? item.children.push(tag) : item.children = [tag];\n        }\n        else {\n          arr.push({ name: tag.group, children: [tag] });\n        }\n      }\n      return arr;\n    };\n    const getList = async () => {\n      try {\n        list.load = true;\n        const { code, result } = await requestList(list.query);\n        list.data = mergeTags(result);\n        list.load = false;\n      }\n      catch (error) {\n        list.load = false;\n      }\n    };\n    getList();\n\n    emitter.on('list-reload', (key) => {\n      if (key === MODULE) getList();\n    });\n\n    return {\n      group,\n      MODULE,\n      list,\n      dialogData,\n      Edit,\n      Delete,\n      Plus,\n      openDialog, handleDelete, getList\n    };\n  }\n});\n</script>\n\n<style lang='less' scoped>\n.custom-tree-node {\n  height: 30px;\n  line-height: 30px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  .el-button:first-child {\n    margin-left: 20px;\n  }\n}\n</style>\n"],"names":["Edit","Delete","Plus","_openBlock","_createElementBlock","_createElementVNode","_createVNode","_withCtx","_Fragment","_createTextVNode","_toDisplayString","_createCommentVNode","_createBlock"],"mappings":"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"}